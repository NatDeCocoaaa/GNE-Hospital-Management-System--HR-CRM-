-- ==========================================
-- I. HUMAN RESOURCES & ACCESS
-- ==========================================

CREATE TABLE departments (
    dept_id INT PRIMARY KEY AUTO_INCREMENT,
    dept_name VARCHAR(100) NOT NULL
);

CREATE TABLE employees (
    id INT PRIMARY KEY AUTO_INCREMENT,
    emp_id_display VARCHAR(15) GENERATED ALWAYS AS (CONCAT('EMP-', LPAD(id, 3, '0'))) VIRTUAL, 
    first_name VARCHAR(50) NOT NULL,
    middle_name VARCHAR(50) NOT NULL,
    last_name VARCHAR(50) NOT NULL,
    role ENUM('HR', 'Doctor', 'FrontDesk') NOT NULL,
    prc_license_no VARCHAR(20) UNIQUE, -- Mandatory for PH Doctors
    hire_date DATE NOT NULL,
    dept_id INT,
    email VARCHAR(100),
    contact_no VARCHAR(15),
    status ENUM('Active', 'On-Leave', 'Resigned') DEFAULT 'Active',
    FOREIGN KEY (dept_id) REFERENCES departments(dept_id)
);

CREATE TABLE users (
    user_id INT PRIMARY KEY AUTO_INCREMENT,
    emp_id INT UNIQUE NOT NULL, 
    username VARCHAR(50) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    access_role ENUM('HR', 'Doctor', 'FrontDesk') NOT NULL,
    is_active BOOLEAN DEFAULT TRUE,
    FOREIGN KEY (emp_id) REFERENCES employees(id) ON DELETE CASCADE
);

CREATE TABLE schedules (
    schedule_id INT PRIMARY KEY AUTO_INCREMENT,
    emp_id INT,
    day_of_week ENUM('Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'),
    shift_start TIME,
    shift_end TIME,
    FOREIGN KEY (emp_id) REFERENCES employees(id) ON DELETE CASCADE
);

-- ==========================================
-- II. PATIENT MANAGEMENT SYSTEM (PMS)
-- ==========================================

CREATE TABLE patients (
    id INT PRIMARY KEY AUTO_INCREMENT,
    patient_id_display VARCHAR(15) GENERATED ALWAYS AS (CONCAT('PAT-', LPAD(id, 3, '0'))) VIRTUAL,
    first_name VARCHAR(50) NOT NULL,
    last_name VARCHAR(50) NOT NULL,
    email VARCHAR(50) NOT NULL,
    dob DATE NOT NULL,
    gender ENUM('Male', 'Female', 'Prefer not to say'),
    contact_no VARCHAR(15),
    blood_type ENUM('A+', 'A-', 'B+', 'B-', 'AB+', 'AB-', 'O+', 'O-')
);

CREATE TABLE beds (
    id INT PRIMARY KEY AUTO_INCREMENT,
    bed_id_display VARCHAR(10) GENERATED ALWAYS AS (CONCAT('BED-', LPAD(id, 2, '0'))) VIRTUAL,
    bed_number VARCHAR(10) UNIQUE NOT NULL,
    ward_type ENUM('Ward', 'Semi-Private', 'Private', 'ICU') NOT NULL,
    price_per_day DECIMAL(10,2) NOT NULL,
    is_occupied BOOLEAN DEFAULT FALSE
);

CREATE TABLE appointments (
    id INT PRIMARY KEY AUTO_INCREMENT,
    appt_id_display VARCHAR(15) GENERATED ALWAYS AS (CONCAT('APT-', LPAD(id, 4, '0'))) VIRTUAL,
    patient_id INT,
    doctor_id INT, 
    appt_date DATETIME NOT NULL,
    visit_reason TEXT,
    status ENUM('Pending', 'Completed', 'Cancelled') DEFAULT 'Pending',
    FOREIGN KEY (patient_id) REFERENCES patients(id),
    FOREIGN KEY (doctor_id) REFERENCES employees(id)
);

CREATE TABLE admissions (
    id INT PRIMARY KEY AUTO_INCREMENT,
    adm_id_display VARCHAR(15) GENERATED ALWAYS AS (CONCAT('ADM-', LPAD(id, 4, '0'))) VIRTUAL,
    patient_id INT,
    bed_id INT,
    admit_date DATETIME DEFAULT CURRENT_TIMESTAMP,
    discharge_date DATETIME NULL,
    status ENUM('Active', 'Discharged') DEFAULT 'Active',
    FOREIGN KEY (patient_id) REFERENCES patients(id),
    FOREIGN KEY (bed_id) REFERENCES beds(id)
);

-- ==========================================
-- III. CLINICAL RECORDS & BILLING
-- ==========================================

CREATE TABLE medical_records (
    id INT PRIMARY KEY AUTO_INCREMENT,
    rec_id_display VARCHAR(15) GENERATED ALWAYS AS (CONCAT('REC-', LPAD(id, 4, '0'))) VIRTUAL,
    patient_id INT,
    doctor_id INT,
    diagnosis TEXT,
    treatment_plan TEXT,
    care_type ENUM('Outpatient', 'Inpatient') NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (patient_id) REFERENCES patients(id),
    FOREIGN KEY (doctor_id) REFERENCES employees(id)
);

CREATE TABLE billing (
    bill_id INT PRIMARY KEY AUTO_INCREMENT,
    patient_id INT,
    admission_id INT NULL, 
    net_amount DECIMAL(10,2) NOT NULL,
    payment_status ENUM('Pending', 'Paid') DEFAULT 'Pending',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (patient_id) REFERENCES patients(id),
    FOREIGN KEY (admission_id) REFERENCES admissions(id)
);